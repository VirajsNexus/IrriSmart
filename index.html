<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Irrigation System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- The core Firebase JS SDK (using npm package) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.0/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, createUserWithEmailAndPassword, 
                signInWithEmailAndPassword, onAuthStateChanged, updateProfile } from "https://www.gstatic.com/firebasejs/9.6.0/firebase-auth.js";
        
        // Your Firebase config (using your provided API key)
        const firebaseConfig = {
            apiKey: "AIzaSyDBIZAh-xGWuxMoHnhiWvTNDVm8lHnYdvw",
            authDomain: "smartirri-vj2609.firebaseapp.com",
            projectId: "smartirri-vj2609",
            storageBucket: "smartirri-vj2609.appspot.com",
            messagingSenderId: "581137454963",
            appId: "1:581137454963:web:b9b4bdde231d6f09c91706",
            measurementId: "G-4LTHYHF9JG"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();
    </script>
    <style>
        .dashboard-card {
            transition: all 0.3s ease;
        }
        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .progress-bar {
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            transition: width 0.5s ease;
        }
    </style>
</head>
<body class="min-h-screen bg-[url('https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/567a0e4c-c038-48b5-87e1-0856dbb7ddbb.png')] bg-cover bg-center">
    <!-- Login/Register Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 w-80">
            <div class="flex mb-4 border-b">
                <button id="loginTab" class="flex-1 py-2 font-bold text-green-700 border-b-2 border-green-700 hover:bg-gray-50">Login</button>
                <button id="registerTab" class="flex-1 py-2 font-medium text-gray-500 hover:bg-gray-50">Register</button>
            </div>
            
            <!-- Login Form -->
            <form id="loginForm" class="space-y-4">
                <input type="email" id="email" placeholder="Email" class="w-full p-2 border rounded" required>
                <input type="password" id="password" placeholder="Password" class="w-full p-2 border rounded" required>
                <div id="loginError" class="text-red-500 text-sm hidden"></div>
                <button type="submit" class="w-full bg-green-600 text-white py-2 rounded hover:bg-green-700">
                    Sign In
                </button>
                <div class="flex items-center my-4">
                    <div class="flex-grow border-t border-gray-300"></div>
                    <span class="mx-2 text-gray-500 text-sm" style="outline: rgb(0, 0, 0) dotted 3px; outline-offset: 1px;">OR</span>
                    <div class="flex-grow border-t border-gray-300"></div>
                </div>
            </form>
            <div class="flex items-center my-4">
                <div class="flex-grow border-t border-gray-300"></div>
                <span class="mx-2 text-gray-500 text-sm">OR</span>
                <div class="flex-grow border-t border-gray-300"></div>
            </div>
            <div id="googleSignInContainer">
                <button id="googleSignInBtn" class="w-full flex justify-center items-center py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50">
                    <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google logo" class="h-5 w-5 mr-2"> Sign in with Google
                </button>
            </div>

            <!-- Register Form (hidden by default) -->
            <form id="registerForm" class="space-y-4 hidden">
                <input type="text" id="regUsername" placeholder="Username" class="w-full p-2 border rounded" required>
                <input type="email" id="regEmail" placeholder="Email" class="w-full p-2 border rounded" required>
                <input type="password" id="regPassword" placeholder="Password" class="w-full p-2 border rounded" required>
                <input type="password" id="regConfirmPassword" placeholder="Confirm Password" class="w-full p-2 border rounded" required>
                <div id="registerError" class="text-red-500 text-sm hidden"></div>
                <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700">
                    Register
                </button>
            </form>
            
            <div class="mt-6 text-center">
                <p class="text-sm text-gray-600 mb-2">Connect with me:</p>
                <div class="flex justify-center space-x-4">
                    <a href="https://www.linkedin.com/in/viraj-jamdhade" target="_blank" class="text-blue-600 hover:text-blue-800">
                        <img src="https://cdn-icons-png.flaticon.com/512/174/174857.png" alt="LinkedIn" class="w-6 h-6">
                    </a>
                    <a href="https://github.com/viraj-jamdhade" target="_blank" class="text-gray-800 hover:text-black">
                        <img src="https://cdn-icons-png.flaticon.com/512/25/25231.png" alt="GitHub" class="w-6 h-6">
                    </a>
                </div>
            </div>
        </div>
    </div>
    <div class="container mx-auto px-4 py-8">
        <!-- City Selection Form (shown by default) -->
        <div id="cityForm" class="max-w-md mx-auto bg-white rounded-xl shadow-md overflow-hidden p-6">
            <div class="text-center mb-6">
                <h1 class="text-3xl font-bold text-green-700">Smart Irrigation System</h1>
                <p class="text-gray-600 mt-2">Enter your location to begin monitoring</p>
                <p class="text-sm text-gray-500 mt-4">Developed by Viraj Jamdhade</p>
            </div>
            
            <form id="locationForm" class="space-y-4">
                <div>
                    <label for="city" class="block text-sm font-medium text-gray-700">City</label>
                    <input type="text" id="city" name="city" required 
                           class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500">
                </div>
                
                <div>
                    <label for="country" class="block text-sm font-medium text-gray-700">Country</label>
                    <input type="text" id="country" name="country" required 
                           class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500">
                </div>
                
                <div>
                    <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                        Start Monitoring
                    </button>
                </div>
            </form>
        </div>

        <!-- Dashboard (hidden by default) -->
        <div id="dashboard" class="hidden">
            <!-- Header with city info -->
            <div class="flex justify-between items-center mb-8">
                <div>
                    <h1 class="text-3xl font-bold text-green-700">Smart Irrigation System</h1>
                    <p id="locationInfo" class="text-gray-600">Loading location...</p>
                </div>
                <button id="changeLocation" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300">
                    Change Location
                </button>
            </div>

            <!-- Main Dashboard -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Weather Card -->
                <div class="dashboard-card bg-white rounded-lg shadow-md p-6">
                    <div class="flex items-center mb-4">
                        <img src="https://openweathermap.org/img/wn/01d@2x.png" alt="Current weather icon" class="weather-icon mr-3" width="50" height="50">
                        <h2 class="text-xl font-semibold text-gray-800">Weather Conditions</h2>
                    </div>
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <div>
                                <span class="text-gray-600">Temperature:</span>
                                <span id="temperature" class="font-medium">--°C</span>
                            </div>
                            <div>
                                <span class="text-sm text-gray-500">Min: <span id="minTemp">--°C</span></span>
                                <span class="text-sm text-gray-500 ml-2">Max: <span id="maxTemp">--°C</span></span>
                            </div>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Humidity:</span>
                            <span id="humidity" class="font-medium">--%</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Precipitation:</span>
                            <span id="precipitation" class="font-medium">--mm</span>
                        </div>
                    </div>
                </div>

                <!-- Soil Moisture Card -->
                <div class="dashboard-card bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">Soil Moisture</h2>
                    <div class="mb-4">
                        <div class="flex justify-between mb-1">
                            <span class="text-gray-600">Moisture Level</span>
                            <span id="moistureLevel" class="font-medium">--%</span>
                        </div>
                        <div class="progress-bar bg-gray-200">
                            <div id="moistureBar" class="progress-fill bg-blue-500" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="text-sm text-gray-500" id="moistureStatus">Sensor data loading...</div>
                </div>

                <!-- Irrigation Control Card -->
                <div class="dashboard-card bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">Irrigation Control</h2>
                    <div class="mb-4">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-gray-600">System Status:</span>
                            <span id="systemStatus" class="px-2 py-1 rounded text-sm font-medium bg-gray-200 text-gray-800">OFF</span>
                        </div>
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-gray-600">Last Watered:</span>
                            <span id="lastWatered" class="text-sm">Never</span>
                        </div>
                    </div>
                    <div class="flex space-x-3">
                        <button id="autoBtn" class="flex-1 py-2 bg-green-600 text-white rounded-md hover:bg-green-700">
                            Auto Mode
                        </button>
                        <button id="manualBtn" class="flex-1 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                            Manual Water
                        </button>
                    </div>
                </div>

                <!-- Water Usage Card -->
                <div class="dashboard-card bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">Water Usage</h2>
                    <div class="mb-4">
                        <div class="flex justify-between mb-1">
                            <span class="text-gray-600">Today's Usage</span>
                            <span id="todayUsage" class="font-medium">-- liters</span>
                        </div>
                        <div class="progress-bar bg-gray-200">
                            <div id="usageBar" class="progress-fill bg-green-500" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Weekly Average:</span>
                        <span id="weeklyAvg" class="font-medium">-- liters/day</span>
                    </div>
                </div>

                <!-- Weather Forecast Card -->
                <div class="dashboard-card bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">3-Day Forecast</h2>
                    <div id="forecastContainer" class="space-y-3">
                        <div class="text-center py-4">Loading forecast...</div>
                    </div>
                </div>

                <!-- System Recommendations Card -->
                <div class="dashboard-card bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">Recommendations</h2>
                    <div id="recommendations" class="space-y-2 text-sm">
                        <div class="p-3 bg-yellow-50 rounded-md text-yellow-800">
                            System recommendations will appear here based on weather and soil conditions.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const cityForm = document.getElementById('cityForm');
        const dashboard = document.getElementById('dashboard');
        const locationForm = document.getElementById('locationForm');
        const changeLocationBtn = document.getElementById('changeLocation');
        const locationInfo = document.getElementById('locationInfo');
        
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "YOUR_FIREBASE_API_KEY",
            authDomain: "YOUR_PROJECT.firebaseapp.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT.appspot.com",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const provider = new firebase.auth.GoogleAuthProvider();

        // Event listeners
        document.addEventListener('DOMContentLoaded', () => {
            // Handle login form submission
            document.getElementById('loginForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const errorEl = document.getElementById('loginError');
            
            signInWithEmailAndPassword(auth, email, password)
                .then(() => {
                    errorEl.classList.add('hidden');
                    document.getElementById('loginModal').classList.add('hidden');
                    checkSavedLocation();
                })
                .catch((error) => {
                    errorEl.textContent = error.message;
                    errorEl.classList.remove('hidden');
                });
        });

        // Handle register form submission
        document.getElementById('registerForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            const confirmPassword = document.getElementById('regConfirmPassword').value;
            const errorEl = document.getElementById('registerError');
            
            if (password !== confirmPassword) {
                errorEl.textContent = "Passwords don't match";
                errorEl.classList.remove('hidden');
                return;
            }
            
            if (password.length < 6) {
                errorEl.textContent = "Password must be at least 6 characters";
                errorEl.classList.remove('hidden');
                return;
            }
            
            createUserWithEmailAndPassword(auth, email, password)
                    .then((userCredential) => {
                        // Add the username to user profile
                        return updateProfile(userCredential.user, {
                            displayName: document.getElementById('regUsername').value
                        });
                    })
                .then(() => {
                    errorEl.classList.add('hidden');
                    alert('Registration successful! You are now logged in');
                    document.getElementById('loginModal').classList.add('hidden');
                    checkSavedLocation();
                })
                .catch((error) => {
                    errorEl.textContent = error.message;
                    errorEl.classList.remove('hidden');
                });
        });

        // Google Sign-in button
        const googleSignInBtn = document.createElement('button');
        googleSignInBtn.className = 'w-full flex justify-center items-center py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50';
        googleSignInBtn.innerHTML = '<img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google logo" class="h-5 w-5 mr-2"> Sign in with Google';
        googleSignInBtn.addEventListener('click', () => {
            signInWithPopup(auth, provider)
                .then(() => {
                    document.getElementById('loginModal').classList.add('hidden');
                    checkSavedLocation();
                })
                .catch((error) => {
                    document.getElementById('loginError').textContent = error.message;
                    document.getElementById('loginError').classList.remove('hidden');
                });
        });

        // Tab switching
        document.getElementById('loginTab').addEventListener('click', () => {
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('registerForm').classList.add('hidden');
            document.getElementById('loginTab').classList.add('border-b-2', 'border-green-700', 'font-bold', 'text-green-700');
            document.getElementById('loginTab').classList.remove('font-medium', 'text-gray-500');
            document.getElementById('registerTab').classList.add('font-medium', 'text-gray-500');
            document.getElementById('registerTab').classList.remove('border-b-2', 'border-green-700', 'font-bold', 'text-green-700');
        });

        document.getElementById('registerTab').addEventListener('click', function() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('registerForm').classList.remove('hidden');
            document.getElementById('registerTab').classList.add('border-b-2', 'border-green-700', 'font-bold', 'text-green-700');
            document.getElementById('registerTab').classList.remove('font-medium', 'text-gray-500');
            document.getElementById('loginTab').classList.add('font-medium', 'text-gray-500');
            document.getElementById('loginTab').classList.remove('border-b-2', 'border-green-700', 'font-bold', 'text-green-700');
            return false;
        });

        import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.6.0/firebase-auth.js";
        
        // Check auth and location
        document.addEventListener('DOMContentLoaded', () => {
            // Show login modal first
            document.getElementById('loginModal').classList.remove('hidden');
            
            // Add Google sign-in button
            const googleSignInContainer = document.getElementById('googleSignInContainer');
            if (googleSignInContainer) {
                googleSignInContainer.appendChild(googleSignInBtn);
            }
            
            const unsubscribe = onAuthStateChanged(auth, (user) => {
                if (user) {
                    document.getElementById('loginModal').classList.add('hidden');
                    const savedCity = localStorage.getItem('irrigationCity');
                    const savedCountry = localStorage.getItem('irrigationCountry');
            
            if (savedCity && savedCountry) {
                // Hide city form and show dashboard
                cityForm.classList.add('hidden');
                dashboard.classList.remove('hidden');
                locationInfo.textContent = `${savedCity}, ${savedCountry}`;
                
                // Load weather data
                loadWeatherData(savedCity, savedCountry);
                simulateSensorData();
            }
        });

        // Handle form submission
        locationForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const city = document.getElementById('city').value;
            const country = document.getElementById('country').value;
            
            // Save to localStorage
            localStorage.setItem('irrigationCity', city);
            localStorage.setItem('irrigationCountry', country);
            
            // Hide city form and show dashboard
            cityForm.classList.add('hidden');
            dashboard.classList.remove('hidden');
            locationInfo.textContent = `${city}, ${country}`;
            
            // Load weather data
            loadWeatherData(city, country);
            simulateSensorData();
        });

        // Listen for auth state changes
        auth.onAuthStateChanged((user) => {
            if (!user) {
                document.getElementById('loginModal').classList.remove('hidden');
            }
        });

        // Change location button
        changeLocationBtn.addEventListener('click', () => {
            dashboard.classList.add('hidden');
            cityForm.classList.remove('hidden');
        });

        // Function to load weather data (real API)
        async function loadWeatherData(city, country) {
            try {
                const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city},${country}&units=metric&appid=YOUR_OPENWEATHER_API_KEY`);
                const data = await response.json();
                
                if (response.ok) {
                    // Store temperature history in localStorage
                    const today = new Date().toDateString();
                    const tempHistory = JSON.parse(localStorage.getItem('tempHistory') || '{}');
                    
                    if (!tempHistory[today] || tempHistory[today].timestamp < Date.now() - 3600000) {
                        tempHistory[today] = {
                            current: Math.round(data.main.temp),
                            min: Math.round(data.main.temp_min),
                            max: Math.round(data.main.temp_max),
                            timestamp: Date.now()
                        };
                        localStorage.setItem('tempHistory', JSON.stringify(tempHistory));
                    }

                    const weatherData = {
                        temperature: tempHistory[today].current,
                        minTemp: tempHistory[today].min,
                        maxTemp: tempHistory[today].max,
                        humidity: data.main.humidity,
                        precipitation: data.rain ? data.rain['1h'] || 0 : 0,
                        conditions: data.weather[0].main
                    };
                
                // Update UI with real weather data
                document.getElementById('temperature').textContent = `${weatherData.temperature}°C`;
                document.getElementById('minTemp').textContent = `${weatherData.minTemp}°C`;
                document.getElementById('maxTemp').textContent = `${weatherData.maxTemp}°C`;
                document.getElementById('humidity').textContent = `${weatherData.humidity}%`;
                document.getElementById('precipitation').textContent = `${weatherData.precipitation}mm`;
                
                // Update weather icon
                const iconCode = data.weather[0].icon;
                document.querySelector('.weather-icon').src = `https://openweathermap.org/img/wn/${iconCode}@2x.png`;
                document.querySelector('.weather-icon').alt = weatherData.conditions;
                
                // Update recommendations based on weather
                updateRecommendations(weatherData);
            }, 1000);
        }

        // Function to get real soil moisture data (example implementation)
        async function getSensorData() {
            try {
                // This would be replaced with your actual sensor API call
                // For now we'll simulate based on weather conditions
                const temp = parseFloat(document.getElementById('temperature').textContent);
                const humidity = parseFloat(document.getElementById('humidity').textContent);
                const precip = parseFloat(document.getElementById('precipitation').textContent);
                
                // Calculate moisture based on weather factors
                let baseMoisture = 30 + (humidity / 2.5);
                if (precip > 0) baseMoisture += 15;
                if (temp > 25) baseMoisture -= 5;
                
                // Keep within realistic bounds
                return Math.max(10, Math.min(90, Math.round(baseMoisture)));
            
            // Set initial moisture level
            getSensorData().then(moisture => {
                
                // Update UI
                document.getElementById('moistureLevel').textContent = `${moisture}%`;
                document.getElementById('moistureBar').style.width = `${moisture}%`;
                
                // Update status text
                const statusElement = document.getElementById('moistureStatus');
                if (moisture < 30) {
                    statusElement.textContent = "Soil is too dry - irrigation recommended";
                    statusElement.className = "text-sm text-red-500";
                } else if (moisture > 60) {
                    statusElement.textContent = "Soil is wet - no irrigation needed";
                    statusElement.className = "text-sm text-green-500";
                } else {
                    statusElement.textContent = "Soil moisture is optimal";
                    statusElement.className = "text-sm text-blue-500";
                }
                
                // Simulate water usage if system is in auto mode
                if (document.getElementById('autoBtn').classList.contains('bg-green-600')) {
                    if (moisture < 30) {
                        activateIrrigation();
                    }
                }
            });
            
            // Simulate water usage data
            simulateWaterUsage();
        }

        // Function to simulate water usage data
        function simulateWaterUsage() {
            let todayUsage = Math.floor(Math.random() * 100) + 50;
            let weeklyAvg = Math.floor(Math.random() * 50) + 50;
            
            // Update every 5 seconds
            setInterval(() => {
                // Random fluctuation
                todayUsage = Math.max(0, todayUsage + Math.floor(Math.random() * 21) - 10);
                weeklyAvg = Math.max(30, weeklyAvg + Math.floor(Math.random() * 11) - 5);
                
                // Update UI
                document.getElementById('todayUsage').textContent = `${todayUsage} liters`;
                document.getElementById('weeklyAvg').textContent = `${weeklyAvg} liters/day`;
                
                // Update progress bar (scaled to 200 liters max)
                const usagePercent = Math.min(100, (todayUsage / 200) * 100);
                document.getElementById('usageBar').style.width = `${usagePercent}%`;
            }, 5000);
        }

        // Function to update recommendations
        function updateRecommendations(weatherData) {
            const recommendations = document.getElementById('recommendations');
            recommendations.innerHTML = '';
            
            // Add recommendations based on conditions
            if (weatherData.precipitation > 3) {
                addRecommendation("Rain expected today - irrigation may not be needed", "info");
            }
            
            if (weatherData.temperature > 25) {
                addRecommendation("High temperatures expected - increase irrigation frequency", "warning");
            }
            
            if (weatherData.humidity < 50) {
                addRecommendation("Low humidity - plants may need more water", "warning");
            }
            
            if (recommendations.children.length === 0) {
                addRecommendation("Conditions are optimal for irrigation", "success");
            }
        }

        // Helper function to add a recommendation
        function addRecommendation(text, type) {
            const colors = {
                info: { bg: 'bg-blue-50', text: 'text-blue-800' },
                warning: { bg: 'bg-yellow-50', text: 'text-yellow-800' },
                success: { bg: 'bg-green-50', text: 'text-green-800' }
            };
            
            const rec = document.createElement('div');
            rec.className = `p-3 rounded-md ${colors[type].bg} ${colors[type].text}`;
            rec.textContent = text;
            document.getElementById('recommendations').appendChild(rec);
        }

        // Irrigation control buttons
        document.getElementById('autoBtn').addEventListener('click', function() {
            this.classList.add('bg-green-700');
            this.classList.remove('bg-green-600');
            document.getElementById('manualBtn').classList.add('bg-blue-600');
            document.getElementById('manualBtn').classList.remove('bg-blue-700');
            document.getElementById('systemStatus').textContent = "AUTO";
            document.getElementById('systemStatus').className = "px-2 py-1 rounded text-sm font-medium bg-green-100 text-green-800";
        });

        document.getElementById('manualBtn').addEventListener('click', function() {
            this.classList.add('bg-blue-700');
            this.classList.remove('bg-blue-600');
            document.getElementById('autoBtn').classList.add('bg-green-600');
            document.getElementById('autoBtn').classList.remove('bg-green-700');
            document.getElementById('systemStatus').textContent = "MANUAL";
            document.getElementById('systemStatus').className = "px-2 py-1 rounded text-sm font-medium bg-blue-100 text-blue-800";
            activateIrrigation();
        });

        // Store irrigation history
        function storeIrrigationEvent() {
            const today = new Date().toDateString();
            const irrigationHistory = JSON.parse(localStorage.getItem('irrigationHistory') || '{}');
            irrigationHistory[today] = (irrigationHistory[today] || 0) + 1;
            localStorage.setItem('irrigationHistory', JSON.stringify(irrigationHistory));
        }

        // Function to simulate irrigation activation
        function activateIrrigation() {
            storeIrrigationEvent();
            document.getElementById('systemStatus').textContent = "WATERING";
            document.getElementById('systemStatus').className = "px-2 py-1 rounded text-sm font-medium bg-blue-100 text-blue-800";
            
            // Update last watered time
            const now = new Date();
            document.getElementById('lastWatered').textContent = now.toLocaleTimeString();
            
            // Simulate watering completion after 5 seconds
            setTimeout(() => {
                if (document.getElementById('autoBtn').classList.contains('bg-green-700')) {
                    document.getElementById('systemStatus').textContent = "AUTO";
                    document.getElementById('systemStatus').className = "px-2 py-1 rounded text-sm font-medium bg-green-100 text-green-800";
                } else {
                    document.getElementById('systemStatus').textContent = "MANUAL";
                    document.getElementById('systemStatus').className = "px-2 py-1 rounded text-sm font-medium bg-blue-100 text-blue-800";
                }
            }, 5000);
        }
    </script>
</body>
</html>
